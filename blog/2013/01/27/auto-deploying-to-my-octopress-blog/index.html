
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Auto-deploying to my Octopress blog with Travis-CI - Hari Menon</title>
  <meta name="author" content="Hari Menon">

  
  <meta name="description" content="A couple weeks earlier, Sergey Klimov (who is @darvin at GitHub) opened the issue #940 at imathis/octopress, which is more a feature suggestion than &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="msvalidate.01" content="09CA63FA87D1D25673E09F580DDBA74D" />

  
  <link rel="canonical" href="https://www.harimenon.com/blog/2013/01/27/auto-deploying-to-my-octopress-blog/">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Hari Menon" type="application/atom+xml">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

    <meta property="twitter:card" content="summary">
    <meta property="twitter:site" content="menonHari">
    <meta property="twitter:url" content="https://www.harimenon.com/blog/2013/01/27/auto-deploying-to-my-octopress-blog/">
    <meta property="twitter:title" content="Auto-deploying to my Octopress blog with Travis-CI">
    <meta property="twitter:description" content="A couple weeks earlier, Sergey Klimov (who is @darvin at GitHub) opened the issue #940 at imathis/octopress, which is more a feature suggestion than an issue. Within that, he has linked to his &hellip;">


<!-- favicon etc. -->
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png">
<link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="/manifest.json">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-TileImage" content="/mstile-144x144.png">
<meta name="theme-color" content="#ffffff">
  
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-4869398-4', 'harimenon.com');
        ga('send', 'pageview');

    </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Hari Menon</a></h1>
  
    <h2>Namaste. Welcome to my personal space on the world wide web!</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:harimenon.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
    <li><a href="/">Home</a></li>
    <li><a href="/blog">Blog</a></li>
    <li><a href="/blog/categories/malayalam-blog/">Malayalam</a></li>
    <li><a href="/blog/categories/english-blog/">English</a></li>
    <li><a href="/blog/categories/technical/">Technical</a></li>
    <li><a href="/blog/archives">Archives</a></li>
</ul>
</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Auto-deploying to My Octopress Blog With Travis-CI</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-01-27T00:00:00+00:00" pubdate data-updated="true">Jan 27<span>th</span>, 2013</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>A couple weeks earlier, <a href="http://darvin.github.com/">Sergey Klimov</a> (who is <a href="https://github.com/darvin">@darvin</a> at GitHub) opened the <a href="https://github.com/imathis/octopress/issues/940">issue #940</a> at <a href="https://github.com/imathis/octopress">imathis/octopress</a>, which is more a feature suggestion than an issue.</p>

<p>Within that, he has linked to <a href="http://darvin.github.com/blog/2013/01/13/Prose_Octopress_TravisIO/" title="Prose.io + Octopress + Travis-CI + GitHub Pages = ♥">his detailed blog post</a> suggesting how the awesome <a href="https://travis-ci.org/">Travis-CI</a> could be configured to do the <code>rake generate</code> and <code>rake deploy</code> for you, when you add/update new posts to an <a href="http://octopress.org/">octopress</a> blog, even from browser-based editors like either the built-in GitHub editor, or a third-party tool like the <a href="http://prose.io">prose.io</a> editor (which is really awesome too, BTW).</p>

<p>For the uninitiated, Travis-CI is a really nice, open source, free and hosted continuous integration service that could build and run the unit tests for you, on every commit to a GitHub repository. It supports projects in a multitude of languages, as seen <a href="http://about.travis-ci.org/docs/user/getting-started/#Travis-CI-Overview">here</a>. The service allows you to configure steps that would be run <a href="http://about.travis-ci.org/docs/user/build-configuration/">before, after and during the build and test process</a>, with just one <a href="http://www.yaml.org/" title="YAML Ain't Markup Language">YAML</a> file (named <code>.travis.yml</code>) in the root of your repo. Apart from running the many unit tests in the project and letting you know how your latest check-in affected the health of the project, the Travis-CI service could also do custom build tasks like a post-build deployment. And this is what Sergey has tappped into, for use with the deployment of an Octopress blog.</p>

<!-- more -->


<p>His blog post really has everything that one would need to set-up Travis-CI for automating the deployment of their blog. This post here is trying to add a couple of tweaks that were done, when I <a href="https://travis-ci.org/floydpink/harimenon.com">successfuly enabled</a> auto-deploy for <a href="/blog">this blog</a> of mine, the source of which can be seen at <a href="https://github.com/floydpink/harimenon.com">floydpink/harimenon.com</a>. (Also, this very post, is in-fact composed on a browser, thanks to <a href="http://prose.io/#floydpink">prose.io</a> service).</p>

<h4>1. Revert _config.yml</h4>

<p>As the <code>before_script</code> is using <code>rake setup_github_pages</code> task every time on Travis to setup the _deploy git correctly, it was overwriting the <code>_config.yml</code> <code>url</code> value to the github <code>url</code>, which would be a problem, if like me, you are deploying this to a custom domain.</p>

<figure class='code'><figcaption><span>_config.yml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='diff'><span class='line'> #      Main Configs       #
</span><span class='line'> # ----------------------- #
</span><span class='line'>
</span><span class='line'><span class="gd">-url: http://www.harimenon.com</span>
</span><span class='line'><span class="gi">+url: http://floydpink.github.com/harimenon</span>
</span><span class='line'> title: Hari Menon
</span><span class='line'> subtitle: Namaste. Welcome to my personal space on the world wide web!
</span><span class='line'> author: Hari Menon
</span></code></pre></td></tr></table></div></figure>


<p>This subtle little thing was manifest only in the tweet button behavior (which fortunately, I noticed when I was trying to tweet this very post) as seen in this screenshot:
<a href="https://i.imgur.com/jLAFiwl.png"><img src="https://i.imgur.com/jLAFiwl.png" title="Tweet button behavior" alt="Tweet button behavior"></a>
Instead of the correct URL - <code>http://www.harimenon.com/blog/2012/12/16/aop-for-logging-in-net/</code>, the tweet was showing - <code>http://floydpink.github.com/harimenon/blog/2012/12/16/aop-for-logging-in-net/</code>.</p>

<p>To fix this, we should add an additional line to revert the <code>_config.yml</code> (especially for the blogs that are hosted with cutom URLs).</p>

<figure class='code'><figcaption><span>.travis.yml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='diff'><span class='line'>   - echo -e &quot;Host github.com\n\tStrictHostKeyChecking no\n&quot; &gt;&gt; ~/.ssh/config
</span><span class='line'>   # Set deployment target to github pages
</span><span class='line'>   - rake setup_github_pages[$REPO]
</span><span class='line'><span class="gi">+  # To reset the &#39;url&#39; to the custom domain in &#39;_config.yml&#39;</span>
</span><span class='line'><span class="gi">+  - git checkout -- _config.yml</span>
</span><span class='line'> script:
</span><span class='line'>   # Generate site
</span><span class='line'>   - rake generate
</span></code></pre></td></tr></table></div></figure>


<h4>2. Add [ci skip] to the commit message</h4>

<p>As a <em>P.S.</em> to his blog post, Sergey talks about how Travis builds the project twice once for the original commit (with the intended changes to the blog) and second because of the commit from the <code>rake deploy</code> applied by this first Travis build (all of this is because, it seems the <code>branches</code> <a href="https://gist.github.com/4522846#file-travis-yml-L1">setting</a> in the <code>.travis.yml</code> that limits it to the <code>source</code> branch only does not seem to work). And he has <a href="https://gist.github.com/4522846#file-travis-yml-L22">a clever workaround</a> in the <code>after_script</code> to stop this at the second build itself rather than going into an infinite loop - <code>'echo ''script: "ls *.html"'' &gt; public/.travis.yml'</code>. I tweaked this a little bit as below:</p>

<p>From one of the earlier encounters, I remembered that the <a href="http://about.travis-ci.org/docs/user/how-to-skip-a-build/">Travis-CI documentation</a> does detail how a specific commit could be made to skip the ci build. Just by including <code>[ci skip]</code> (including the brackets) somewhere in the commit message. So the first tweak I did is this in the <code>Rakefile</code>:</p>

<figure class='code'><figcaption><span>Rakefile</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='diff'><span class='line'> system &quot;git add .&quot;
</span><span class='line'> system &quot;git add -u&quot;
</span><span class='line'> puts &quot;\n## Commiting: Site updated at #{Time.now.utc}&quot;
</span><span class='line'><span class="gd">-    message = &quot;Site updated at #{Time.now.utc}&quot;</span>
</span><span class='line'><span class="gi">+    message = &quot;Site updated at #{Time.now.utc} [ci skip]&quot;</span>
</span><span class='line'> system &quot;git commit -m \&quot;#{message}\&quot;&quot;
</span><span class='line'> puts &quot;\n## Pushing generated #{deploy_dir} website&quot;
</span><span class='line'> system &quot;git push origin #{deploy_branch} --force&quot;
</span></code></pre></td></tr></table></div></figure>


<h4>3. Syntax changes in using the travis command line tool to encrypt deploy key</h4>

<p>Also, because I had to upgrade to the latest version of the Travis, which has slightly different command-line syntaxes now, I had to tweak <a href="https://gist.github.com/4242707">the script he has referred to</a>, to generate the <code>secure</code> argument for the deploy key. My version is as below:</p>

<div><script src='https://gist.github.com/4631240.js'></script>
<noscript><pre><code></code></pre></noscript></div>


<p>The difference essentially is only in the <code>ENCRYPTION_FILTER</code> environment variable, that holds the way the <code>travis</code> command line client would be used to generate the encrypted deploy key.</p>

<p>One more occasion, where I feel like I have done something <em>a la</em> a dwarf standing on the shoulders of giants.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Hari Menon</span></span>

      








  


<time datetime="2013-01-27T00:00:00+00:00" pubdate data-updated="true">Jan 27<span>th</span>, 2013</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/octopress/'>Octopress</a>, <a class='category' href='/blog/categories/travis-ci/'>Travis-CI</a>, <a class='category' href='/blog/categories/blog/'>blog</a>, <a class='category' href='/blog/categories/technical/'>technical</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="https://www.harimenon.com/blog/2013/01/27/auto-deploying-to-my-octopress-blog/" data-via="menonHari" data-counturl="https://www.harimenon.com/blog/2013/01/27/auto-deploying-to-my-octopress-blog/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2013/01/22/using-keyboard-as-mouse/" title="Previous Post: Using keyboard as mouse">&laquo; Using keyboard as mouse</a>
      
      
        <a class="basic-alignment right" href="/blog/2013/02/14/start-webrick-here/" title="Next Post: Start WEBrick Web Server Here">Start WEBrick Web Server Here &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
    <h1>About Me</h1>
    <p>Check out my <a href="http://about.me/hpachuveetil">about.me page</a>.</p>
    <h2 class="social-icons">
        <!-- Social Media Icons: Font Awesome by Dave Gandy - http://fontawesome.io -->
        <a href="https://github.com/floydpink" title="GitHub"><i class="fa fa-github-square fa-lg"></i></a>
        <a href="http://stackoverflow.com/users/218882/floyd-pink" title="Stack Overflow"><i class="fa fa-stack-overflow fa-lg"></i></a>
        <a href="http://twitter.com/menonHari" title="Twitter"><i class="fa fa-twitter-square fa-lg"></i></a>
        <a href="http://www.linkedin.com/in/haridaspachuveetil" title="LinkedIn"><i class="fa fa-linkedin-square fa-lg"></i></a>
        <a href="http://careers.stackoverflow.com/hari" title="Stack Overflow Careers"><i class="fa fa-signal fa-lg"></i></a>
        <a href="http://flickr.com/photos/me_haridas" title="Flickr"><i class="fa fa-flickr fa-lg"></i></a>
        <a href="https://plus.google.com/115681177381332236508/about" title="Google+"><i class="fa fa-google-plus-square fa-lg"></i></a>
    </h2>
    <p><a href="/gpg/public-key.txt" title="If you need to send me a really secure email !">My GPG Key</a></p>
    <p><a href="/blog/2014/12/30/resume/" title="My résumé imported from Stack Overflow Careers!">My Résumé</a></p>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/01/25/ios-app-for-malayalam-bhagavad-gita/">iOS App for Malayalam Bhagavad Gita</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/12/30/resume/">Résumé</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/09/10/android-app-for-malayalam-bhagavad-gita/">Android App For Malayalam Bhagavad Gita</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/04/15/a-full-blossom/">A Full Blossom</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/02/20/srimad-bhagavad-gita/">ശ്രീമദ് ഭഗവദ്ഗീത</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>Stack Overflow</h1>
  <a href="http://stackoverflow.com/users/218882/floyd-pink" style="white-space: normal;">
  <img src="https://stackoverflow.com/users/flair/218882.png" width="208" height="58" alt="Stack Overflow profile: Floyd Pink" title="Stack Overflow profile: Floyd Pink">
  </a>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/floydpink">@floydpink</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'floydpink',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <p><a class="twitter-timeline" href="https://twitter.com/menonHari" data-widget-id="363374556922146816">Tweets by @menonHari</a></p>
  <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</section>


<section class="googleplus googleplus-hidden">
  <h1>
    <a href="https://plus.google.com/115681177381332236508?rel=author">
      <img src="https://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p title="Last Updated: 2015-12-18T17:41:12+00:00">
  Copyright &copy; 2009 - 2015 - Hari Menon -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'harimenonenglishblog';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'https://www.harimenon.com/blog/2013/01/27/auto-deploying-to-my-octopress-blog/';
        var disqus_url = 'https://www.harimenon.com/blog/2013/01/27/auto-deploying-to-my-octopress-blog/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'https://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'https://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
